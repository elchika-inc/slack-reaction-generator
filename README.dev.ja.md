# 開発者向けドキュメント - Slack Reaction Generator

このドキュメントは、Slack Reaction Generatorプロジェクトの開発や貢献を行う開発者向けの包括的な情報を提供します。

## 🏗️ プロジェクト設計

### 技術スタック
- **フロントエンド**: React（Preact経由）+ Vite
- **スタイリング**: Tailwind CSS + PostCSS
- **Canvas操作**: HTML5 Canvas API
- **アニメーション**: GIF.jsライブラリ
- **ファイル処理**: FileSaver.js
- **ビルドツール**: Vite
- **デプロイ**: Cloudflare Pages（Wrangler経由）

### 主要な依存関係
```json
{
  "@preact/compat": "^18.3.1",
  "file-saver": "^2.0.5",
  "gif.js": "^0.2.0",
  "preact": "^10.27.0",
  "react-color": "^2.19.3",
  "sharp": "^0.34.3"
}
```

## 🚀 開発環境の設定

### 前提条件
- Node.js 18+ とnpm
- Git

### インストール
```bash
# リポジトリをクローン
git clone <repository-url>
cd slack-reaction-generator

# 依存関係をインストール
npm install

# 開発サーバーを起動
npm run dev
```

### 利用可能なスクリプト
```bash
# 開発
npm run dev              # ホットリロード付きの開発サーバー起動

# ビルド
npm run build            # 本番用ビルド
npm run postbuild        # ポストビルドスクリプト実行（プリレンダー、CSS抽出）

# 品質保証
npm run lint             # ESLint実行

# デプロイ
npm run deploy           # Cloudflare Pagesへのビルド＆デプロイ
npm run preview          # 本番ビルドのローカルプレビュー

# ユーティリティ
npm run clean            # ビルド成果物の削除
```

## 📁 プロジェクト構造

```
slack-reaction-generator/
├── public/                 # 静的アセット
│   ├── faviconの各種バリアント
│   ├── manifest.json
│   ├── robots.txt
│   └── ワーカーファイル
├── src/
│   ├── components/        # Reactコンポーネント
│   │   ├── ColorPicker.jsx
│   │   ├── Header.jsx
│   │   ├── IconEditor.jsx
│   │   ├── MobilePreviewModal.jsx
│   │   └── PreviewPanel.jsx
│   ├── constants/         # アプリケーション定数
│   │   └── canvasConstants.js
│   ├── utils/            # ユーティリティ関数
│   │   ├── canvasUtils.js      # Canvas操作
│   │   ├── networkAware.js     # ネットワーク最適化
│   │   └── textRenderer.js     # テキストレンダリング
│   ├── App.jsx           # メインアプリケーションコンポーネント
│   ├── main.jsx          # アプリケーションエントリーポイント
│   └── index.css         # グローバルスタイル
├── scripts/              # ビルドスクリプト
│   ├── convert-images.js
│   ├── extract-critical-css.js
│   └── prerender.js
├── _headers              # Cloudflareヘッダー
├── _redirects            # Cloudflareリダイレクト
└── 設定ファイル
```

## 🔧 コアコンポーネント

### App.jsx
以下を管理するメインアプリケーションコンポーネント：
- アイコン設定の状態管理
- モバイル/デスクトップのレスポンシブ動作
- Canvasレンダリングとアニメーション
- ファイル生成とダウンロード

### IconEditor.jsx
以下を含むメイン編集インターフェース：
- テキスト入力と書式設定コントロール
- カラーピッカー統合
- アニメーション選択
- フォントファミリーオプション

### PreviewPanel.jsx
以下の機能を持つデスクトッププレビューコンポーネント：
- リアルタイムCanvasレンダリング
- エクスポート機能
- 複数サイズプレビュー（128x128、32x32）

### Canvas ユーティリティ（canvasUtils.js）
コアCanvas操作関数：
- `generateIconData()`: メイン生成関数
- `drawTextIcon()`: 静的テキストレンダリング
- `drawAnimationFrame()`: アニメーションフレームレンダリング
- フォント読み込みとキャッシュ
- パフォーマンス最適化

## 🎨 Canvas レンダリングシステム

### テキストレンダリングパイプライン
1. **フォント読み込み**: フォールバック付き非同期フォント読み込み
2. **サイズ計算**: Canvas寸法に基づく自動サイズ調整
3. **位置決め**: オーバーフロー処理付き中央配置
4. **色適用**: 単色とグラデーション
5. **背景**: 透明または色付き背景

### アニメーションシステム
- **フレームベース**: アニメーションサイクルあたり30フレーム
- **設定可能な速度**: フレームあたり20ms〜1000ms
- **エフェクトタイプ**: グロー、パルス、バウンス、シェイク、回転、点滅
- **パフォーマンス**: スロットリング付きRequestAnimationFrame

### 最適化戦略
- **ネットワーク対応**: 低速接続時の機能削減
- **メモリ管理**: Canvasクリーンアップとガベージコレクション最適化
- **遅延読み込み**: フォントとライブラリの遅延読み込み
- **モバイル最適化**: アニメーション複雑さの削減

## 📱 レスポンシブデザイン

### ブレークポイント
- **モバイル**: < 1024px
- **デスクトップ**: ≥ 1024px

### モバイル専用機能
- 固定ボトムプレビューパネル
- 生成時の自動ダウンロード
- 簡素化されたUI要素
- タッチ最適化コントロール

## 🔄 ビルドプロセス

### 開発ビルド
1. ホットモジュール交換付きVite開発サーバー
2. TailwindのためのPostCSS処理
3. ESLint統合

### 本番ビルド
1. **Viteビルド**: バンドル最適化と圧縮
2. **プリレンダリング**: 静的HTML生成（`scripts/prerender.js`）
3. **クリティカルCSS**: クリティカルスタイルのインライン化（`scripts/extract-critical-css.js`）
4. **アセットコピー**: Cloudflare用ヘッダーとリダイレクト

### デプロイパイプライン
- Wrangler経由でのCloudflare Pages統合
- gitプッシュでの自動ビルド
- パフォーマンス最適化のためのカスタムヘッダー

## 🧪 テスト戦略

### 手動テストチェックリスト
- [ ] テキスト入力機能
- [ ] カラーピッカー操作
- [ ] アニメーションプレビュー
- [ ] ファイルダウンロード（GIF/PNG）
- [ ] モバイルレスポンシブ性
- [ ] クロスブラウザ対応
- [ ] 低速ネットワークでのパフォーマンス

### パフォーマンス指標
- First Contentful Paint (FCP): < 1.5s
- Largest Contentful Paint (LCP): < 2.5s
- Canvasレンダリング: フレームあたり< 100ms
- ファイル生成: 複雑なアニメーションで< 3s

## 🔍 コード品質

### ESLint設定
```json
{
  "extends": ["eslint:recommended", "@vitejs/plugin-react"],
  "rules": {
    "react-hooks/exhaustive-deps": "warn",
    "no-unused-vars": "error"
  }
}
```

### ベストプラクティス
- **コンポーネント構造**: 単一責任の原則
- **状態管理**: 明確なデータフローでの最小状態
- **パフォーマンス**: メモ化とエフェクトクリーンアップ
- **アクセシビリティ**: ARIAラベルとキーボードナビゲーション
- **エラーハンドリング**: グレースフルデグラデーション

## 🚀 パフォーマンス最適化

### 読み込みパフォーマンス
- HTMLにクリティカルCSSインライン
- フォントプリロードと表示最適化
- 将来のインタラクションのためのリソースプリフェッチ
- オフライン機能のためのサービスワーカー

### ランタイムパフォーマンス
- Canvas操作のスロットリング
- メモリリーク防止
- ネットワーク対応機能切り替え
- 効率的なアニメーションフレーム管理

### バンドル最適化
- 大規模依存関係のコード分割
- 未使用コードのツリーシェイキング
- アセット圧縮と最適化
- 外部リソースのCDN活用

## 🔒 セキュリティ考慮事項

### 入力検証
- テキスト入力のサニタイゼーション
- ファイルアップロード制限
- MIMEタイプ検証
- サイズ制限

### コンテンツセキュリティポリシー
- `_headers`経由での厳格なCSPヘッダー
- インラインスクリプト制限
- 外部リソース制限

## 📊 分析とモニタリング

### パフォーマンスモニタリング
- Core Web Vitals追跡
- エラーログと報告
- ユーザーインタラクション指標
- ネットワークパフォーマンス分析

### 機能使用状況
- アニメーション設定追跡
- フォント選択分析
- ダウンロード形式分布
- モバイル対デスクトップ使用状況

## 🛠️ 開発ツール

### 推奨エクステンション
- ES7+ React/Redux/React-Native snippets
- Tailwind CSS IntelliSense
- ESLint
- Prettier

### デバッグ設定
```javascript
// Viteデバッグモード
localStorage.setItem('debug', 'slack-reaction-generator:*');
```

## 🚦 貢献ガイドライン

### コードスタイル
- フック付き関数コンポーネントを使用
- Reactのベストプラクティスに従う
- 一貫した命名規則を維持
- 複雑な関数の文書化

### プルリクエストプロセス
1. フォークしてフィーチャーブランチを作成
2. テスト付きで変更を実装
3. ドキュメントを更新
4. 明確な説明付きでPRを提出
5. レビューフィードバックに対応

### 問題報告
- 提供されたIssueテンプレートを使用
- ブラウザとデバイス情報を含める
- 再現手順を提供
- 関連するスクリーンショットを添付

## 📈 今後の拡張

### 計画された機能
- SVGエクスポートサポート
- バッチ処理
- テンプレートライブラリ
- 高度なアニメーションエディター
- クラウドストレージ統合

### 技術的負債
- 新しいReact機能への移行
- TypeScriptカバレッジの改善
- 強化されたエラーバウンダリ
- より良い状態管理

---

追加の技術的質問については、メインREADMEを参照するか、GitHubでIssueを作成してください。